# 智能指针（smart pointer）

内存管理是C++中一个常见的错误和bug来源。许多bug都来自动态内存分配和指针的使用。当程序中广泛使用动态内存分配并且在对象间传递多个指针的时候，很容易忘记每一个指针只能在正确的时间执行一次delete操作。出错的后果很严重：

1. 当多次释放动态分配的内存的时候，可能会导致内存数据损坏或致命的运行时错误；
2. 当忘记释放动态分配的内存时，会导致内存泄漏。

智能指针帮助管理动态分配的内存，这是避免内存泄漏建议采用的技术。智能指针来自于一个事实：通过把所有内容都放在堆栈上可以避免大部分和内存相关的问题。堆栈比堆安全的多，因为当堆栈中的变量离开作用域的时候会被自动销毁并清理。智能指针结合了堆栈变量的安全性和堆变量的灵活性。

有几种智能指针。最简单的智能指针对内存有唯一的所有权，当智能指针离开作用域的时候会释放所引用的内存，例如，c++11的unique_ptr。还有旧的过时的auto_ptr，c++11已经正式废弃了auto_ptr,并且用shared_ptr和unique_ptr替代了auto_ptr,因为auto_ptr存在一些严重的缺点，缺点之一就是在STL容器（vector）中使用的时候无法正常工作。

注：不要再使用auto_ptr!而使用新的c++11引入的shared_ptr或unique_ptr!

shared_ptr是引用计数的智能指针，而unique_ptr不是引用计数的智能指针，这意味着，可以有多个shared_ptr实例指向同一块内存，当最后一个shared_ptr离开作用域的时候这块内存才会被释放。出于这个原因shared_ptr的使用比unique_ptr更安全且更简单。

# More

https://dablelv.blog.csdn.net/article/details/81478223