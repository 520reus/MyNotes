# 编译与链接过程

一个C++语言程序是如何从一个个.h和.cpp文件变成包含1和0的可执行文件呢？

可以认为有以下的几个环节

**源程序－>预处理－>编译和优化->生成目标文件－>链接－>可执行文件**

## 一、预处理

预处理指令有：**1.宏定义 2.条件编译 3.文件包含**

​		C++的预处理是指在C++程序源代码被编译之前，由预处理器对C++程序源代码进行的处理。这个过程并不对程序的源代码进行解析。这里的预处理器（preprocessor）是指**真正的编译开始之前**由编译器调用的一个独立程序。

预处理器主要负责以下的几处

**1.宏的替换**

**2.删除注释**

**3.处理预处理指令，如#include，#ifdef**

## 二、编译和优化

![](C:\Users\Administrator\Desktop\292249100095523.png)

## 三、生成目标文件

​		在最终的目标文件中除了拥有自己的数据和二进制代码之外，还要至少提供2个表：**未解决符号表**和**导出符号表**，分别告诉链接器自己需要什么和能够提供什么。

​		编译器把一个cpp编译为目标文件的时候，除了要在目标文件里写入cpp里包含的数据和代码，还要至少提供3个表：未解决符号表，导出符号表和地址重定向表。   
**未解决符号表提供了所有在该编译单元里引用但是定义并不在本编译单元里的符号及其出现的地址。    
导出符号表提供了本编译单元具有定义，并且愿意提供给其他编译单元使用的符号及其地址。**    
地址重定向表提供了本编译单元所有对自身地址的引用的记录。



## 四、链接

​		由汇编程序生成的目标文件并不能立即就被执行，其中可能还有许多没有解决的问题。例如，某个源文件中的函数可能引用了另一个源文件中定义的某个符号（如变量或者函数调用等）；在程序中可能调用了某个库文件中的函数，等等。所有的这些问题，都需要经链接程序的处理方能得以解决。









